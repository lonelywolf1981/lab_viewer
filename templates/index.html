<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>LeMuRe Viewer</title>
  <link rel="stylesheet" href="/static/style.css?v=20260116170000"/>
  <!-- Plotly через CDN (если интернет закрыт — скажи, сделаю офлайн-версию с локальным plotly.js) -->
  <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>LeMuRe Viewer</h1>
      <div class="sub">Локальный просмотрщик Prova*.dbf. Порт: {{port}}</div>
    </header>

    <section class="panel">
      <div class="row">
        <label>Папка теста:</label>
        <input id="folder" type="text" placeholder="Например: C:\Tests\...\Test-05" />
        <button id="btnPick">Обзор…</button>
        <button id="btnLoad">Загрузить</button>
      </div>

      <div class="row">
        <div class="box">
          <div class="boxTitle">Сводка</div>
          <div id="summary">Не загружено</div>
        </div>

        <div class="box">
          <div class="boxTitle">Каналы</div>
          <div class="chanToolbar">
            <button id="btnAll" type="button">Выбрать все</button>
            <button id="btnNone" type="button">Снять все</button>
            <span class="sortBox">
              <label for="sortMode">Сортировка:</label>
              <select id="sortMode">
                <option value="file" selected>Как в файле</option>
                <option value="custom">Мой порядок (сохранённый)</option>
                <option value="priority">Приоритет + человекоудобно</option>
                <option value="natural">Человекоудобно по коду</option>
                <option value="label">По названию</option>
                <option value="unit">По единицам, затем код</option>
              </select>
            </span>
          </div>
          <div class="orderToolbar">
            <input id="orderName" type="text" placeholder="Имя порядка…"/>
            <button id="btnSaveNamed" type="button">Сохранить</button>
            <select id="orderSelect" title="Сохранённые порядки"></select>
            <button id="btnLoadNamed" type="button">Загрузить</button>
            <button id="btnRefreshOrders" type="button">Обновить</button>
          </div>
          <ul id="channelList" class="chanList" tabindex="0"></ul>
          <div class="hint">Выбор как в Windows: клик — выбрать, Ctrl+клик — добавить/убрать, Shift+клик — диапазон. Двойной клик — оставить только этот канал.</div>
        </div>

        <div class="box">
          <div class="boxTitle">Диапазон / Экспорт</div>

          <div class="row2">
            <label>Шаг (каждый N-й замер):</label>
            <input id="step" type="number" min="1" value="1" style="width:80px"/>
          </div>

          <div class="row2">
            <button id="btnDraw">Построить график</button>
          </div>

          <div class="row2">
            <button id="btnCsv">Экспорт CSV</button>
            <button id="btnXlsx">Экспорт Excel</button>
            <button id="btnTpl">В шаблон XLSX</button>
            <span id="tplStatus" class="statusText"></span>
          </div>

          <div class="row2">
            <div><b>Выбранный интервал:</b> <span id="rangeText">—</span></div>
          </div>

          <div class="stylePanel">
            <div class="styleTitle">Оформление экспорта (шаблон XLSX)</div>

            <div class="row2">
              <label>Строки B..P, если T &lt;</label>
              <input id="rmThreshold" type="number" step="0.1" style="width:90px"/>
              <label>цвет:</label>
              <input id="rmColor" type="color"/>
            </div>

            <div class="row2">
              <label>Интенсивность:</label>
              <input id="rmIntensity" type="range" min="0" max="100" value="100"/>
              <span id="rmIntensityVal" class="mini">100</span>
            </div>

            <div class="scaleGrid">
              <div class="scaleRow">
                <div class="scaleName">W</div>
                <label>min</label><input id="wMin" type="number" step="0.1"/>
                <label>opt</label><input id="wOpt" type="number" step="0.1"/>
                <label>max</label><input id="wMax" type="number" step="0.1"/>
              </div>
              <div class="scaleRow">
                <div class="scaleName">X</div>
                <label>min</label><input id="xMin" type="number" step="0.1"/>
                <label>opt</label><input id="xOpt" type="number" step="0.1"/>
                <label>max</label><input id="xMax" type="number" step="0.1"/>
              </div>
              <div class="scaleRow">
                <div class="scaleName">Y</div>
                <label>min</label><input id="yMin" type="number" step="0.1"/>
                <label>opt</label><input id="yOpt" type="number" step="0.1"/>
                <label>max</label><input id="yMax" type="number" step="0.1"/>
              </div>
            </div>

            <div class="row2">
              <button id="btnSaveStyle" type="button">Применить</button>
              <span id="styleStatus" class="statusText"></span>
            </div>

            <div class="hint mini">
              Эти настройки сохраняются в viewer_settings.json и применяются к следующей выгрузке «В шаблон XLSX».
              Шкала W/X/Y независима от других ячеек: используются фиксированные min/opt/max.
            </div>
          </div>

          <div class="hint">
            Интервал экспорта берётся из видимой области графика по оси X.
            Увеличь/уменьши масштаб (выделением мышью или колесом). Текущий интервал покажу справа. Также можно двигать range-slider снизу.
          </div>
        </div>
      </div>
    </section>

    <section class="plotPanel">
      <div class="plotTitle">График</div>
      <div class="plotSub">Подсказка: двойной клик по легенде — оставить только одну линию. Один клик — скрыть/показать линию.</div>
      <div id="plot" class="plot"></div>
    </section>

    <section class="logPanel">
      <div class="boxTitle">Лог</div>
      <pre id="log"></pre>
    </section>
  </div>

  <script src="/static/app.js?v=20260116170000"></script>
</body>
</html>
