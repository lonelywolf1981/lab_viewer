![Логотип ТОО "Jasyl Suyq Qazaqstan"](static/img.png){width=50% align=center}

# ИЛХО Viewer

Локальный веб-просмотрщик данных лабораторных испытаний LeMuRe/Project Engineering (файлы Prova*.dbf). Этот инструмент позволяет визуализировать и анализировать экспериментальные данные из оборудования для испытаний материалов через веб-интерфейс.

## Возможности

- **Веб-интерфейс**: Доступ к данным испытаний через веб-браузер
- **Поддержка нескольких платформ**: Совместимость с Windows 7 и более новыми системами (протестировано на Windows 11)
- **Визуализация в реальном времени**: Интерактивные графики для анализа данных испытаний по времени
- **Экспорт данных**: Экспорт данных в форматах CSV и XLSX
- **Экспорт в шаблоны**: Заполнение Excel-шаблонов с форматированными данными с сохранением формул и стилей
- **Управление каналами**: Изменение порядка и настройка отображаемых каналов измерений
- **Условное форматирование**: Визуальное выделение на основе пороговых значений
- **Настраиваемые параметры**: Настройка цветовых схем и порогов через интерфейс или JSON-конфигурацию

## Требования

- Python 3.8 или выше (рекомендуется Python 3.8 для совместимости с Windows 7)
- Операционная система Windows (протестировано на Windows 7 и Windows 11)

## Установка

### Быстрая установка (Windows)

1. **Распакуйте** проект в простой путь (избегайте кириллических символов и Program Files)
   ```
   Пример: C:\Tools\LeMuReViewer\
   ```

2. **Установите Python**
   - Для совместимости с Windows 7: Python 3.8.x
   - Только для Windows 11: Python 3.11/3.12 подойдут
   - Проверьте установку: `python -V` или `py -V`

3. **Запустите скрипт установки**
   ```cmd
   Setup_Once.cmd
   ```
   - Создает виртуальное окружение
   - Устанавливает необходимые зависимости
   - Создает файл журнала (`setup.log`) для устранения неполадок

4. **Запустите просмотрщик**
   ```cmd
   Start_Viewer.cmd
   ```
   - Автоматически запускает веб-сервер
   - Открывает просмотрщик в вашем браузере по адресу `http://127.0.0.1:8787/`

## Зависимости

Приложение требует следующие пакеты Python:
- Flask==2.2.5
- openpyxl==3.1.2

Они автоматически устанавливаются во время настройки.

## Использование

### Формат данных
Просмотрщик поддерживает данные испытаний LeMuRe/Project Engineering в следующем формате:
- `Prova*.dbf` - Основные файлы данных, содержащие временные ряды измерений
- `Set/Canali.def` - Файл определения каналов с названиями и единицами измерения каналов
- `Prova*.dat` - Файл метаданных (необязательно)

### Основной интерфейс
1. **Выбор папки**: Выберите папку, содержащую ваши данные испытаний
2. **Выбор каналов**: Выберите, какие каналы измерений отображать
3. **Временной диапазон**: Выберите конкретные периоды времени для анализа
4. **Визуализация**: Интерактивные графики с возможностью масштабирования и перемещения
5. **Параметры экспорта**: Загрузка данных в различных форматах

### Функции экспорта
- **Экспорт CSV**: Простые значения, разделенные запятыми
- **Экспорт XLSX**: Формат Excel со всеми выбранными данными
- **Экспорт в шаблон**: Заполнение предопределенных Excel-шаблонов с правильным форматированием и формулами

### Конфигурация

#### Упорядочивание каналов
- Порядок каналов сохраняется в файле `channel_order.json`
- Пользовательские заказы могут быть сохранены и загружены через интерфейс
- Заказы хранятся в каталоге `saved_orders/`

#### Настройки просмотра
Файл `viewer_settings.json` содержит:
- **Выделение строк**: Порог для выделения строк на основе значений столбца T
- **Цветовые шкалы**: Настраиваемые 3-точечные цветовые шкалы для столбцов W, X, Y
- **Цвета**: Настраиваемые цвета и интенсивность для визуальных индикаторов

Пример структуры настроек:
```json
{
  "row_mark": {
    "threshold_T": 150.0,
    "color": "#EAB106",
    "intensity": 100
  },
  "scales": {
    "W": {
      "min": -3.0,
      "opt": 1.0,
      "max": 2.0,
      "colors": {
        "min": "#059939",
        "opt": "#00FF00",
        "max": "#FF0000"
      }
    }
  }
}
```

## Структура проекта

```
lab_viewer/
├── server.py              # Основное Flask-приложение
├── lemure_reader.py       # Парсер DBF-файлов и загрузчик данных
├── requirements.txt       # Зависимости Python
├── Setup_Once.cmd         # Скрипт установки
├── Start_Viewer.cmd       # Скрипт запуска
├── channel_order.json     # Порядок каналов по умолчанию
├── viewer_settings.json   # Конфигурация просмотра
├── static/                # Ассеты интерфейса (CSS, JavaScript)
├── templates/             # HTML-шаблоны
├── saved_orders/          # Сохраненные именованные заказы каналов
├── .venv/                 # Виртуальное окружение (создается при установке)
└── README.md              # Этот файл
```

## Устранение неполадок

- **Пустые графики**: Если графики пустые и у вас нет подключения к интернету, просмотрщик загружает Plotly из CDN. Обратитесь к разработчику за автономной сборкой.
- **Ошибки установки**: Проверьте файл `setup.log` для получения подробной информации об ошибках
- **Проблемы во время выполнения**: Проверьте файл `run.log` для ошибок выполнения
- **Python не найден**: Убедитесь, что Python установлен и добавлен в системный PATH

## Автономная работа

Приложение предназначено для работы в автономном режиме после первоначальной настройки. Однако библиотека построения графиков (Plotly) по умолчанию загружается из CDN. Для полностью автономной работы может потребоваться изменить `templates/index.html`, чтобы использовать локальные копии JavaScript-библиотек.

## Лицензия

Этот проект доступен как открытый исходный код на условиях лицензии MIT (см. файл LICENSE для деталей).

## Участие

Вклады приветствуются! Пожалуйста, не стесняйтесь отправлять Pull Request. Для существенных изменений, пожалуйста, сначала откройте issue, чтобы обсудить, что вы хотели бы изменить.

## Поддержка

Для поддержки, пожалуйста, создайте issue в репозитории GitHub или свяжитесь с первоначальным автором.