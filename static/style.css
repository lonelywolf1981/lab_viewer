/* базовая предсказуемость размеров */
*, *::before, *::after { box-sizing: border-box; }

body { font-family: Arial, sans-serif; background:#f6f6f6; margin:0; }
.wrap { max-width: 1720px; min-width: 1080px; margin: 0 auto; padding: 14px; }
header { background:#ffffff; padding: 12px 14px; border-radius: 10px; box-shadow: 0 1px 3px rgba(0,0,0,.08); }
h1 { margin:0; font-size: 22px; }
.sub { color:#555; margin-top:6px; font-size: 13px; }

.panel { margin-top: 12px; background:#fff; padding: 12px 14px; border-radius: 10px; box-shadow: 0 1px 3px rgba(0,0,0,.08); }
.row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
.topRow{ margin-bottom: 12px; }
.row label { min-width: 90px; color:#333; }
#folder { flex:1; min-width: 320px; padding: 7px 9px; }
button { padding: 7px 12px; cursor:pointer; }

.box { background:#fafafa; border:1px solid #e5e5e5; border-radius: 10px; padding: 10px; min-width: 300px; flex:1; }
.boxTitle { font-weight: bold; margin-bottom: 8px; }
.hint { color:#666; font-size: 12px; margin-top: 8px; line-height: 1.35; }
.row2 { display:flex; gap:8px; align-items:center; margin: 6px 0; flex-wrap:wrap; }

/* ===== Layout: summary on top + 3 equal columns ===== */
.summaryWide{ flex: 0 0 100%; min-width: 0; margin-bottom: 10px; }
#summary{white-space:nowrap;}
.main3{
  margin-top: 10px;
  display:grid;
  grid-template-columns: 1.15fr 1.55fr 1.25fr;
  gap: 12px;
  align-items: stretch;
  height: clamp(520px, 62vh, 720px);
  min-height: 0; /* важно: даём детям grid сжиматься */
}
.main3 .box{
  min-width: 0;          /* важно для grid, чтобы не раздувало колонки */
  flex: 0 0 auto;        /* отключаем старый flex:1, он тут не нужен */
  display:flex;
  flex-direction:column;
  min-height: 0;         /* критично для внутренней прокрутки */
  height: 100%;
}
.boxContent{
  flex:1;
  overflow:auto;
  /* Важно для flex/grid: иначе содержимое может "выталкивать" высоту и перекрывать соседние блоки */
  min-height: 0;
  padding-right: 4px;
}
/* Список каналов должен занимать доступную высоту и скроллиться внутри */
.listContent{
  display:flex;
  flex:1;
  flex-direction:column;
  min-height:0;
}
.chanList{ min-height: 0; }

/* Чтобы у списка каналов была одна прокрутка (внутри списка), без второй прокрутки у boxContent */
.listBox .boxContent{ overflow:hidden; }

.plotPanel { margin-top: 12px; background:#fff; padding: 10px; border-radius: 10px; box-shadow: 0 1px 3px rgba(0,0,0,.08); }
.plot { width: 100%; height: 620px; }

.logPanel { margin-top: 12px; background:#fff; padding: 10px; border-radius: 10px; box-shadow: 0 1px 3px rgba(0,0,0,.08); }
#log { margin:0; max-height: 200px; overflow:auto; }

.plotTitle { font-weight: bold; margin: 4px 0 2px 4px; }
.plotSub { color:#666; font-size: 12px; margin: 0 0 8px 4px; }

.chanToolbar{display:flex;flex-direction:column;gap:10px;margin-bottom:10px;}

.btnRow2{display:flex;gap:8px;}
.btnRow2 button{flex:1;width:100%;}

.sortRow{display:flex;gap:8px;align-items:center;}
.sortRow label{min-width:90px;}
.sortRow select{flex:1;min-width:0;width:100%;padding:6px 8px;border-radius:8px;border:1px solid #ddd;}

.chanList {
  list-style: none;
  padding: 0;
  margin: 0;
  flex: 1 1 auto;
  height: auto;
  max-height: none;
  overflow: auto;
  border:1px solid #e5e5e5;
  border-radius: 10px;
  background:#fff;
}
.chanItem { display:flex; align-items:center; gap:10px; padding: 6px 8px; border-bottom: 1px solid #f0f0f0; }
.chanItem:last-child { border-bottom: none; }
.chanItem:hover { background:#fafafa; }
.dragHandle { cursor: grab; user-select:none; width: 18px; text-align:center; color:#777; }
.dragHandle.dragDisabled { cursor: not-allowed; opacity: .35; }
.chanCode { font-weight:bold; min-width: 70px; }
.chanLabel { color:#222; }
.chanItem.dragging { opacity: 0.6; }
.chanItem.dragOver { outline: 2px dashed #bbb; outline-offset: -2px; }

.chanItem.selected { background:#eaf2ff; }
.chanItem.selected:hover { background:#dfeaff; }
.chanItem:focus { outline:none; }

.sortBox { margin-left: auto; display:flex; gap:6px; align-items:center; }
.sortBox select { padding: 4px 6px; border-radius: 8px; border:1px solid #ddd; }

.orderToolbar{display:flex;flex-direction:column;gap:8px;margin:6px 0 10px 0;}
.orderToolbar .rowLine{display:flex;gap:8px;align-items:center;}
.orderToolbar .rowLine > *{min-width:0;}
.orderToolbar .rowLine input{flex:1;}
.orderToolbar .rowLine select{flex:1;width:100%;}

#orderName { flex: 1; min-width: 180px; padding: 6px 8px; }
#orderSelect{width:100%;padding:6px 8px;border-radius:8px;border:1px solid #ddd;}

.presetToolbar{display:flex;flex-direction:column;gap:8px;margin:6px 0 6px 0;}
.presetToolbar .rowLine{display:flex;gap:8px;align-items:center;}
.presetToolbar .rowLine > *{min-width:0;}
.presetToolbar .rowLine input{flex:1;}
.presetToolbar .rowLine select{flex:1;width:100%;}
.btnRow3{display:flex;gap:8px;}
.btnRow3 button{flex:1;width:100%;}

#presetName { flex: 1; min-width: 220px; padding: 6px 8px; }
#presetSelect{width:100%;padding:6px 8px;border-radius:8px;border:1px solid #ddd;}

/* Template export button */
#btnTpl { white-space: nowrap; }


.statusText{margin-left:10px;font-size:13px;opacity:.85;}
.statusText .spinner{display:inline-block;width:12px;height:12px;border:2px solid #bbb;border-top-color:#333;border-radius:50%;animation:spin .8s linear infinite;vertical-align:-2px;margin-right:6px;}
@keyframes spin{to{transform:rotate(360deg);}}
.btnBusy{opacity:.7;pointer-events:none;}

#tplStatus{display:inline-block;min-width:260px;}

/* Export styling controls */
.stylePanel{margin-top:10px;padding:10px;border:1px dashed #ddd;border-radius:10px;background:#fff;}
.styleTitle{font-weight:bold;margin-bottom:6px;}
.mini{font-size:11px;opacity:.85;}
.scaleGrid{display:flex;flex-direction:column;gap:8px;margin-top:6px;overflow-x:hidden;}

.scaleRow{
  display:grid;
  grid-template-columns: 16px minmax(0, 1fr) minmax(0, 1fr) minmax(0, 1fr);
  gap: 8px;
  align-items:center;
}

.scaleName{font-weight:bold;min-width:14px;}

.scaleGroup{
  display:grid;
  grid-template-columns: 22px minmax(0, 1fr) 30px;
  align-items:center;
  gap: 4px;
  min-width: 0;
}

.sgLabel{
  width:22px;
  text-align:right;
  font-size:11px;
  opacity:.85;
}

.scaleGroup input[type=number]{
  width: 100%;
  min-width: 0;
  padding:2px 4px;
  font-size:11px;
  box-sizing:border-box;
  position:relative;
  z-index:1;
}
#rmColor{width:44px;height:28px;padding:0;border:1px solid #ddd;border-radius:6px;}
#rmIntensity{width:100%;}

.scaleGroup input[type=color]{
  width:30px;
  height:22px;
  padding:0;
  border:1px solid #ddd;
  border-radius:6px;
  box-sizing:border-box;
  position:relative;
  z-index:3; /* всегда кликабельно */
}

/* В некоторых браузерах у input[type=color] бывают внутренние отступы */
.scaleGroup input[type=color]::-webkit-color-swatch-wrapper{padding:0;}
.scaleGroup input[type=color]::-webkit-color-swatch{border:none;border-radius:6px;}


/* Step hints */
.qmark{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:18px;
  height:18px;
  border-radius:50%;
  border:1px solid #bbb;
  color:#555;
  font-size:12px;
  cursor:help;
  user-select:none;
  background:#fff;
}
.helpText{
  font-size:12px;
  color:#666;
  line-height:1.35;
  margin-top:2px;
  margin-bottom:6px;
}

/* ===== UX/UI additions (filters, busy overlay, toasts) ===== */

.filterToolbar{
  display:flex;
  gap:8px;
  align-items:center;
  flex-wrap:wrap;
  margin: 6px 0 6px 0;
}
#chanSearch{
  flex:1;
  min-width: 220px;
  padding: 6px 8px;
}
.check{display:inline-flex;gap:6px;align-items:center;font-size:12px;color:#333;user-select:none;}
.check input{transform: translateY(1px);}
.miniBadge{
  font-size:12px;
  background:#fff;
  border:1px solid #ddd;
  border-radius:999px;
  padding: 4px 8px;
  color:#333;
  white-space:nowrap;
}

.chipRow{display:flex;gap:6px;align-items:center;flex-wrap:wrap;margin: 2px 0 8px 0;}
.chip{
  padding: 4px 10px;
  border-radius:999px;
  border:1px solid #ddd;
  background:#fff;
  cursor:pointer;
  font-size:12px;
}
.chip:hover{background:#f6f6f6;}
.chip.active{background:#eaf2ff;border-color:#b8d0ff;}
.chipClear{border-style:dashed;}
.chipSep{display:inline-block;width:10px;}

.stepRow select{padding: 5px 7px; border-radius: 8px; border:1px solid #ddd; font-size:12px;}

/* Busy overlay */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.18);display:flex;align-items:center;justify-content:center;z-index:9999;}
.overlay.hidden{display:none;}
.overlayBox{background:#fff;border-radius:12px;box-shadow:0 6px 22px rgba(0,0,0,.2);padding:18px 18px 14px 18px;min-width:260px;max-width:480px;display:flex;gap:12px;align-items:center;}
.overlayText{font-size:13px;color:#333;line-height:1.35;}
.spinnerLarge{
  width:20px;
  height:20px;
  border:3px solid #bbb;
  border-top-color:#333;
  border-radius:50%;
  animation:spin .8s linear infinite;
  flex:0 0 20px;
  min-width:20px;
  box-sizing:border-box;
}

/* Toasts */
.toastContainer{position:fixed;right:16px;top:16px;display:flex;flex-direction:column;gap:8px;z-index:10000;}
.toast{background:#111;color:#fff;padding:10px 12px;border-radius:10px;max-width:420px;font-size:13px;box-shadow:0 4px 18px rgba(0,0,0,.25);opacity:.95;}
.toast.info{background:#111;}
.toast.ok{background:#0b6b2a;}
.toast.warn{background:#8a5a00;}
.toast.err{background:#8a1020;}
.toast .tTitle{font-weight:bold;margin-bottom:4px;}
.toast .tBody{opacity:.95;}

/* ===== Stage 3: view modes, groups, recent folders, export info ===== */

.recentSel{
  min-width: 220px;
  padding: 6px 8px;
  border-radius: 8px;
  border:1px solid #ddd;
  background:#fff;
}

.btnMini{
  padding: 6px 10px;
  font-size: 12px;
}

.exportInfo{
  margin: 8px 0;
  padding: 8px 10px;
  border: 1px solid #cfe1ff;
  border-radius: 10px;
  background:#f5f9ff;
  font-size: 12px;
  color:#333;
  line-height: 1.35;
}

/* Unit badge */
.chanUnitBadge{
  display:inline-block;
  font-size: 11px;
  padding: 2px 7px;
  border-radius: 999px;
  border:1px solid #cfe1ff;
  background:#eef6ff;
  color:#1f3b6d;
  white-space:nowrap;
}

/* Compact view */
.chanList.compact .chanItem{ padding: 4px 8px; gap: 8px; }
.chanList.compact .chanCode{ min-width: 62px; font-size: 12px; }
.chanList.compact .chanLabel{ font-size: 12px; }
.chanList.compact .dragHandle{ width: 16px; }

/* Group view */
.chanGroupHeader{
  display:flex;
  align-items:center;
  gap:10px;
  padding: 6px 8px;
  border-bottom: 1px solid #d9e8ff;
  background:#eaf2ff;
  border-left: 4px solid #7aa7ff;
  font-weight:bold;
  user-select:none;
  cursor:pointer;
}
.chanGroupHeader:hover{ background:#dfeaff; }
.chanGroupCaret{ width: 18px; text-align:center; color:#555; }
.chanGroupTitle{ flex:1; }
.chanGroupCount{ font-weight:normal; opacity:.8; font-size:12px; }
.chanItem.groupHidden{ display:none; }



/* Align label + unit badge */
.chanLabel{ flex:1; }

.exportBtnRow{display:flex;gap:8px;margin:6px 0;}
.exportBtnRow button{flex:1;width:100%;}
.exportOptRow{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:6px 0;}

.controlsBox .boxContent{overflow-x:hidden;}
.exportBox .boxContent{overflow-x:hidden;}
